{
  "nodes": [
    {
      "parameters": {
        "formTitle": "Upload Files to Gemini File Search",
        "formDescription": "Upload PDF or text files to be indexed in Google Gemini File Search Store",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Upload File",
              "fieldType": "file",
              "multipleFiles": false,
              "acceptFileTypes": ".pdf, .txt",
              "requiredField": true
            }
          ]
        },
        "options": {
          "appendAttribution": false,
          "buttonLabel": "Upload File"
        }
      },
      "id": "e5bbe4a4-a933-4b7d-a879-8741530cb1e7",
      "name": "File Upload Form",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        2416,
        -80
      ],
      "webhookId": "53507463-04ff-4627-a563-c1fcee98d7cb"
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "const API_KEY = 'AIzaSyBdEKVPVlMUbu65c5NVntmJL_CbWQ02fn4';\n\n// Get the uploaded file\nconst uploadFile = $input.first().json['Upload File'];\nconst binaryData = $input.first().binary;\nconst binaryKey = Object.keys(binaryData)[0];\nconst fileBuffer = await this.helpers.getBinaryDataBuffer(0, binaryKey);\n\n// Step 1: Create File Search Store\nconst storeResponse = await $http.request({\n  method: 'POST',\n  url: `https://generativelanguage.googleapis.com/v1beta/fileSearchStores?key=${API_KEY}`,\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  body: {\n    display_name: 'n8n_documents_store'\n  },\n  json: true\n});\n\nconst storeName = storeResponse.name;\n\n// Step 2: Upload File to Store using $http with formData\nconst uploadResponse = await $http.request({\n  method: 'POST',\n  url: `https://generativelanguage.googleapis.com/upload/v1beta/${storeName}/files?key=${API_KEY}`,\n  headers: {\n    'X-Goog-Upload-Protocol': 'multipart'\n  },\n  formData: {\n    metadata: {\n      value: JSON.stringify({\n        file: {\n          display_name: uploadFile.filename\n        }\n      }),\n      options: {\n        contentType: 'application/json'\n      }\n    },\n    file: {\n      value: fileBuffer,\n      options: {\n        filename: uploadFile.filename,\n        contentType: uploadFile.mimetype\n      }\n    }\n  }\n});\n\nreturn {\n  json: {\n    success: true,\n    storeName: storeName,\n    storeResponse: storeResponse,\n    uploadResponse: uploadResponse,\n    filename: uploadFile.filename\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2640,
        -80
      ],
      "id": "all-in-one",
      "name": "Create Store and Upload File"
    }
  ],
  "connections": {
    "File Upload Form": {
      "main": [
        [
          {
            "node": "Create Store and Upload File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "aaadb797535f05587ee95b776c942a7c3f7a46fd7aa0c9b6a9d64e1e595f8af1"
  }
}
